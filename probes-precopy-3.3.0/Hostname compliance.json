{
  "label": "Hostname compliance",
  "description": "Raise anomaly if FQDN of any system does not match specified regex.",
  "processors": [
    {
      "inputs": {},
      "type": "service_data_collector",
      "name": "FQDN collector",
      "outputs": {
        "out": "fqdn"
      },
      "properties": {
        "graph_query": "node('system', name='system', system_id=not_none(), deploy_mode='deploy')",
        "keys": [
          "hostname"
        ],
        "service_name": "hostname",
        "hostname": "'fqdn'",
        "system_id": "system.system_id",
        "enable_streaming": false
      }
    },
    {
      "inputs": {
        "in": "fqdn"
      },
      "type": "match_string",
      "name": "Match FQDN",
      "outputs": {
        "out": "matched_fqdns"
      },
      "properties": {
        "graph_query": [],
        "anomaly_retention_size": 1073741824,
        "anomaly_retention_duration": 86400,
        "raise_anomaly": false,
        "enable_streaming": false,
        "regexp": "'hoge'",
        "enable_anomaly_logging": false
      }
    },
    {
      "inputs": {
        "in": "matched_fqdns"
      },
      "type": "state_check",
      "name": "Check FQDN mismatches",
      "outputs": {
        "out": "fqdn_mismatch"
      },
      "properties": {
        "graph_query": [],
        "anomaly_retention_size": 1073741824,
        "anomaly_retention_duration": 86400,
        "state": "'false'",
        "raise_anomaly": true,
        "enable_streaming": false,
        "enable_anomaly_logging": false
      }
    }
  ],
  "stages": [
    {
      "name": "matched_fqdns",
      "retention_duration": 86400
    },
    {
      "name": "fqdn_mismatch",
      "retention_duration": 86400
    },
    {
      "name": "fqdn",
      "retention_duration": 86400
    }
  ]
}