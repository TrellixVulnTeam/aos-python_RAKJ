{"label": "Overlay - ESI Imbalance", "description": "The probe calculates ESI imbalance", "processors": [{"inputs": {}, "type": "if_counter", "name": "esi interface traffic", "outputs": {"out": "esi_int_traffic"}, "properties": {"leaf": "str(leaf.label)", "graph_query": "match(node(\"system\", name=\"leaf\", role=\"leaf\", deploy_mode=\"deploy\").in_(\"composed_of_systems\").node(\"redundancy_group\", name=\"rg\", rg_type=\"esi\").out(\"hosted_interfaces\").node(\"interface\", name=\"virtual_pc\", if_type=\"port_channel\").out(\"composed_of\").node(\"interface\", name=\"leaf_port_channel\", if_type=\"port_channel\").out(\"composed_of\").node(\"interface\", name=\"leaf_interface\", if_name=not_none()).out(\"link\").node(\"link\", name=\"link\").in_(\"link\").node(\"interface\", name=\"server_interface\").in_(\"hosted_interfaces\").node(\"system\", name=\"server\", role=is_in([\"l2_server\", \"access\", \"external_router\"])),node(\"system\", name=\"leaf\").out(\"hosted_interfaces\").node(\"interface\", name=\"leaf_interface\", if_name=not_none()),node(\"system\", name=\"leaf\").out(\"interface_map\").node(\"interface_map\").out(\"device_profile\").node(\"device_profile\", name=\"dp\"))", "leaf_pair": "str(rg.label)", "server": "str(server.label)", "esi_id": "str(functions.build_esi_id(virtual_pc.evpn_esi_mac, dp.selector[\"os\"]))", "link_speed": "int(functions.speed_to_bits(link.speed))", "system_id": "leaf.system_id", "enable_streaming": false, "interface": "leaf_interface.if_name", "counter_type": "tx_bps"}}, {"inputs": {"in": "esi_int_traffic"}, "type": "periodic_average", "name": "esi interface traffic average", "outputs": {"out": "esi_int_traffic_avg"}, "properties": {"enable_streaming": false, "period": 60, "graph_query": []}}, {"inputs": {"in": "esi_int_traffic_avg"}, "type": "std_dev", "name": "esi interface traffic imbalance", "outputs": {"out": "esi_int_traffic_imbalance"}, "properties": {"enable_streaming": false, "group_by": ["leaf_pair", "esi_id", "server", "link_speed"], "ddof": 0}}, {"inputs": {"numerator": "esi_int_traffic_imbalance"}, "type": "ratio", "name": "std-dev percentage esi", "outputs": {"out": "std_dev_percentage_esi"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"in": "std_dev_percentage_esi"}, "type": "range_check", "name": "live esi imbalance", "outputs": {"out": "live_esi_imbalance"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "live_esi_imbalance"}, "type": "match_count", "name": "count of imbalanced esis", "outputs": {"out": "esi_imbalance_link_count"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}], "stages": [{"name": "live_esi_imbalance", "retention_duration": 86400}, {"name": "esi_int_traffic", "retention_duration": 86400, "units": "bps"}, {"name": "std_dev_percentage_esi", "retention_duration": 3600, "units": "%"}, {"name": "esi_imbalance_link_count", "retention_duration": 86400, "description": "Number of ESI links with imbalance."}, {"name": "esi_int_traffic_imbalance", "retention_duration": 86400, "units": "bps"}, {"name": "esi_int_traffic_avg", "retention_duration": 86400, "units": "bps"}], "disabled": true}