{"label": "Data_Plane - LAG Imbalance", "description": "The probe calculates LAG imbalance", "processors": [{"inputs": {}, "type": "if_counter", "name": "lag traffic", "outputs": {"out": "lag_traffic"}, "properties": {"graph_query": "node('system', role=is_in(['leaf', 'access']),     deploy_mode='deploy', name='system').out('hosted_interfaces').node('interface', if_type='port_channel').out('composed_of').node('interface', name='iface').out('link').node('link', role='leaf_l2_server', name='link').in_('link').node('interface').in_('hosted_interfaces').node('system', role='l2_server', name='server')", "link_speed": "int(functions.speed_to_bits(link.speed))", "interface": "iface.if_name", "server_label": "str(server.label)", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "tx_bps"}}, {"inputs": {"in": "lag_traffic"}, "type": "periodic_average", "name": "lag traffic average", "outputs": {"out": "lag_traffic_avg"}, "properties": {"enable_streaming": false, "period": 60, "graph_query": []}}, {"inputs": {"in": "lag_traffic_avg"}, "type": "std_dev", "name": "lag traffic imbalance", "outputs": {"out": "lag_traffic_imbalance"}, "properties": {"enable_streaming": false, "group_by": ["system_id", "server_label", "link_speed"], "ddof": 0}}, {"inputs": {"numerator": "lag_traffic_imbalance"}, "type": "ratio", "name": "lag traffic std-dev percentage", "outputs": {"out": "lag_std_dev_percentage"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"in": "lag_std_dev_percentage"}, "type": "range_check", "name": "lag traffic imbalance range", "outputs": {"out": "lag_imbalance_range"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "lag_imbalance_range"}, "type": "match_count", "name": "lag imbalance count", "outputs": {"out": "lag_imbalance_count"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}], "stages": [{"name": "lag_imbalance_count", "retention_duration": 86400, "description": "Number of LAG links with imbalance."}, {"name": "lag_traffic_imbalance", "retention_duration": 86400, "units": "bps"}, {"name": "lag_traffic", "retention_duration": 86400, "units": "bps"}, {"name": "lag_traffic_avg", "retention_duration": 86400, "units": "bps"}, {"name": "lag_imbalance_range", "retention_duration": 86400}, {"name": "lag_std_dev_percentage", "retention_duration": 86400, "units": "%"}], "disabled": true}