{"label": "Data_Plane - ECMP Imbalance (External Interfaces)", "description": "The probe calculates ECMP imbalance on external router facing ports", "processors": [{"inputs": {}, "type": "if_counter", "name": "external interface traffic", "outputs": {"out": "external_int_traffic"}, "properties": {"graph_query": "node(\"system\", name=\"system\", deploy_mode=\"deploy\",     system_id=not_none()).out(\"hosted_interfaces\").node(\"interface\", name=\"iface\", if_name=not_none()).out(\"link\").node(\"link\", link_type=\"ethernet\", name=\"link\").in_(\"link\").node(\"interface\").in_(\"hosted_interfaces\").node(\"system\", role=\"external_router\")", "label": "str(system.label)", "interface": "iface.if_name", "link_speed": "int(functions.speed_to_bits(link.speed))", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "tx_bps"}}, {"inputs": {"in": "external_int_traffic"}, "type": "periodic_average", "name": "external interface traffic avg", "outputs": {"out": "external_int_traffic_avg"}, "properties": {"enable_streaming": false, "period": 30, "graph_query": []}}, {"inputs": {"in": "external_int_traffic_avg"}, "type": "std_dev", "name": "external interface std-dev", "outputs": {"out": "ext_int_std_dev"}, "properties": {"enable_streaming": false, "group_by": ["system_id", "label", "link_speed"], "ddof": 0}}, {"inputs": {"numerator": "ext_int_std_dev"}, "type": "ratio", "name": "std-dev percentage", "outputs": {"out": "std_dev_percentage"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"in": "std_dev_percentage"}, "type": "range_check", "name": "live ecmp imbalance", "outputs": {"out": "live_ecmp_imbalance"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": false, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "live_ecmp_imbalance"}, "type": "match_perc", "name": "links imbalanced percentage", "outputs": {"out": "links_imbalanced_percentage"}, "properties": {"enable_streaming": false, "group_by": ["system_id", "label"], "reference_state": "true"}}, {"inputs": {"in": "links_imbalanced_percentage"}, "type": "range_check", "name": "systems imbalanced", "outputs": {"out": "systems_imbalanced"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 1}, "raise_anomaly": false, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "systems_imbalanced"}, "type": "time_in_state_check", "name": "sustained ecmp imbalance", "outputs": {"out": "sustained_ecmp_imbalance"}, "properties": {"time_window": 300, "graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "state_range": {"\"true\"": [{"min": 131}]}, "raise_anomaly": true, "enable_streaming": false, "enable_anomaly_logging": false}}, {"inputs": {"in": "sustained_ecmp_imbalance"}, "type": "match_count", "name": "systems imbalanced count", "outputs": {"out": "system_tx_imbalance_count"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}, {"inputs": {"in": "system_tx_imbalance_count"}, "type": "range_check", "name": "live systems imbalanced", "outputs": {"out": "live_system_imbalance_count"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 2}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}], "stages": [{"name": "external_int_traffic_avg", "enable_metric_logging": true, "retention_duration": 300, "units": "bps"}, {"name": "ext_int_std_dev", "retention_duration": 86400, "units": "bps"}, {"name": "std_dev_percentage", "enable_metric_logging": true, "retention_duration": 300, "units": "%"}, {"name": "systems_imbalanced", "retention_duration": 86400}, {"name": "links_imbalanced_percentage", "retention_duration": 86400}, {"name": "external_int_traffic", "retention_duration": 86400, "units": "bps"}, {"name": "system_tx_imbalance_count", "retention_duration": 86400, "description": "Number of router facing systems with ECMPimbalance."}, {"name": "live_system_imbalance_count", "enable_metric_logging": true, "retention_duration": 86400}, {"name": "live_ecmp_imbalance", "retention_duration": 86400}, {"name": "sustained_ecmp_imbalance", "enable_metric_logging": true, "retention_duration": 86400}], "disabled": true}