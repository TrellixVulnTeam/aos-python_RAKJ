{"label": "Data_Plane - Packet discard percentage", "description": "Raise anomaly on ports with persistent ingress discards above a configured percent threshold.", "processors": [{"inputs": {}, "type": "if_counter", "name": "rx broadcast pkts", "outputs": {"out": "rx broadcast pkts"}, "properties": {"graph_query": ["node('system', name='system', system_id=not_none()).out('hosted_interfaces').node('interface', if_type=is_in(['ip','ethernet']), if_name=not_none(), name='interface')"], "metric": "'rx_broadcast_pps'", "interface": "interface.if_name", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "rx_broadcast_pps"}}, {"inputs": {}, "type": "if_counter", "name": "rx discard pkts", "outputs": {"out": "rx discard pkts"}, "properties": {"interface": "interface.if_name", "enable_streaming": false, "system_id": "system.system_id", "graph_query": ["node('system', name='system', system_id=not_none()).out('hosted_interfaces').node('interface', if_type=is_in(['ip','ethernet']), if_name=not_none(), name='interface')"], "counter_type": "rx_discard_pps"}}, {"inputs": {}, "type": "if_counter", "name": "rx multicast pkts", "outputs": {"out": "rx multicast pkts"}, "properties": {"graph_query": ["node('system', name='system', system_id=not_none()).out('hosted_interfaces').node('interface', if_type=is_in(['ip','ethernet']), if_name=not_none(), name='interface')"], "metric": "'rx_multicast_pps'", "interface": "interface.if_name", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "rx_multicast_pps"}}, {"inputs": {}, "type": "if_counter", "name": "rx unicast pkts", "outputs": {"out": "rx unicast pkts"}, "properties": {"graph_query": ["node('system', name='system', system_id=not_none()).out('hosted_interfaces').node('interface', if_type=is_in(['ip','ethernet']), if_name=not_none(), name='interface')"], "metric": "'rx_unicast_pps'", "interface": "interface.if_name", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "rx_unicast_pps"}}, {"inputs": {"broadcast": "rx broadcast pkts", "unicast": "rx unicast pkts", "multicast": "rx multicast pkts"}, "type": "union", "name": "Combined rx metrics", "outputs": {"out": "Combined rx metrics"}, "properties": {"enable_streaming": false, "significant_keys": []}}, {"inputs": {"in": "rx discard pkts"}, "type": "periodic_average", "name": "rx discard pkts average", "outputs": {"out": "rx discard pkts average"}, "properties": {"enable_streaming": false, "period": 20, "graph_query": []}}, {"inputs": {"in": "Combined rx metrics"}, "type": "periodic_average", "name": "Combined rx metrics average", "outputs": {"out": "Combined rx metrics average"}, "properties": {"enable_streaming": false, "period": 20, "graph_query": []}}, {"inputs": {"in": "Combined rx metrics average"}, "type": "sum", "name": "Total rx pkts", "outputs": {"out": "Total rx pkts"}, "properties": {"enable_streaming": false, "group_by": ["system_id", "interface"]}}, {"inputs": {"denominator": "Total rx pkts", "numerator": "rx discard pkts average"}, "type": "ratio", "name": "rx discard percentage", "outputs": {"out": "rx discard percentage"}, "properties": {"enable_streaming": false, "significant_keys": ["system_id", "interface"], "multiplier": 100}}, {"inputs": {"in": "rx discard percentage"}, "type": "range_check", "name": "discard percent threshold", "outputs": {"out": "discard percent threshold"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 2}, "raise_anomaly": false, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "discard percent threshold"}, "type": "time_in_state_check", "name": "Persistent discards", "outputs": {"out": "Persistent discards anomaly"}, "properties": {"time_window": 90, "graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "state_range": {"\"true\"": [{"min": 21}]}, "raise_anomaly": true, "enable_streaming": false, "enable_anomaly_logging": false}}, {"inputs": {"in": "Persistent discards anomaly"}, "type": "match_count", "name": "Ports with persistent ingress discards", "outputs": {"out": "Ports with persistent ingress discards"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}], "stages": [{"name": "Combined rx metrics average", "retention_duration": 86400, "units": "pps"}, {"name": "rx unicast pkts", "retention_duration": 86400, "units": "pps"}, {"name": "Total rx pkts", "enable_metric_logging": true, "retention_duration": 43200, "units": "pps"}, {"name": "rx discard pkts average", "enable_metric_logging": true, "retention_duration": 43200, "units": "pps"}, {"name": "Combined rx metrics", "retention_duration": 86400, "units": "pps"}, {"name": "discard percent threshold", "retention_duration": 86400}, {"name": "rx discard pkts", "retention_duration": 86400, "units": "pps"}, {"name": "rx discard percentage", "enable_metric_logging": true, "retention_duration": 43200, "units": "%"}, {"name": "Persistent discards anomaly", "retention_duration": 86400}, {"name": "rx broadcast pkts", "retention_duration": 86400, "units": "pps"}, {"name": "rx multicast pkts", "retention_duration": 86400, "units": "pps"}, {"name": "Ports with persistent ingress discards", "retention_duration": 86400}], "disabled": true}