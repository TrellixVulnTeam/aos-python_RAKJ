{"label": "Layer2 - MLAG Imbalance", "description": "The probe calculates MLAG imbalance", "processors": [{"inputs": {}, "type": "if_counter", "name": "mlag interface traffic", "outputs": {"out": "mlag_int_traffic"}, "properties": {"leaf": "str(leaf.label)", "mlag_id": "int(mlag_interface.mlag_id)", "graph_query": "match(node(\"system\", name=\"leaf\", role=\"leaf\", deploy_mode=\"deploy\").in_(\"composed_of_systems\").node(\"redundancy_group\", name=\"rack\").out(\"hosted_interfaces\").node(\"interface\", name=\"mlag_interface\", if_type=\"port_channel\").out(\"composed_of\").node(\"interface\", name=\"leaf_port_channel\", if_type=\"port_channel\").out(\"composed_of\").node(\"interface\", name=\"leaf_interface\").out(\"link\").node(\"link\", name=\"link\").in_(\"link\").node(\"interface\", name=\"server_interface\").in_(\"hosted_interfaces\").node(\"system\", name=\"server\", role=\"l2_server\"),node(\"system\", name=\"leaf\").out(\"hosted_interfaces\").node(\"interface\", name=\"leaf_interface\"))", "server": "str(server.label)", "interface": "leaf_interface.if_name", "link_speed": "int(functions.speed_to_bits(link.speed))", "system_id": "leaf.system_id", "enable_streaming": false, "rack": "str(rack.label)", "counter_type": "tx_bps"}}, {"inputs": {"in": "mlag_int_traffic"}, "type": "periodic_average", "name": "mlag interface traffic average", "outputs": {"out": "mlag_int_traffic_avg"}, "properties": {"enable_streaming": false, "period": 60, "graph_query": []}}, {"inputs": {"in": "mlag_int_traffic_avg"}, "type": "std_dev", "name": "mlag interface traffic imbalance", "outputs": {"out": "mlag_int_traffic_imbalance"}, "properties": {"enable_streaming": false, "group_by": ["rack", "server", "link_speed"], "ddof": 0}}, {"inputs": {"in": "mlag_int_traffic_avg"}, "type": "std_dev", "name": "port-channel interface std-dev", "outputs": {"out": "port_channel_int_std_dev"}, "properties": {"enable_streaming": false, "group_by": ["rack", "mlag_id", "leaf", "link_speed"], "ddof": 0}}, {"inputs": {"in": "mlag_int_traffic_avg"}, "type": "sum", "name": "port-channel total traffic", "outputs": {"out": "mlag_port_channel_total"}, "properties": {"enable_streaming": false, "group_by": ["rack", "mlag_id", "leaf", "link_speed"]}}, {"inputs": {"in": "mlag_port_channel_total"}, "type": "std_dev", "name": "mlag port-channel traffic std-dev", "outputs": {"out": "mlag_port_channel_imbalance"}, "properties": {"enable_streaming": false, "group_by": ["rack", "mlag_id", "link_speed"], "ddof": 0}}, {"inputs": {"numerator": "mlag_int_traffic_imbalance"}, "type": "ratio", "name": "std-dev percentage mlag", "outputs": {"out": "std_dev_percentage_mlag"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"numerator": "port_channel_int_std_dev"}, "type": "ratio", "name": "std-dev percentage port-channel", "outputs": {"out": "std_dev_percentage_pc"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"in": "std_dev_percentage_mlag"}, "type": "range_check", "name": "live mlag imbalance", "outputs": {"out": "live_mlag_imbalance"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "std_dev_percentage_pc"}, "type": "range_check", "name": "live port-channel imbalance", "outputs": {"out": "live_port_channel_imbalance"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"numerator": "mlag_port_channel_imbalance"}, "type": "ratio", "name": "std-dev percentage mlag port-channel", "outputs": {"out": "std_dev_percentage_mlag_pc"}, "properties": {"enable_streaming": false, "denominator": "context.link_speed", "significant_keys": [], "multiplier": 100}}, {"inputs": {"in": "std_dev_percentage_mlag_pc"}, "type": "range_check", "name": "live mlag port-channel imbalance", "outputs": {"out": "mlag_port_channel_imbalance_out_of_range"}, "properties": {"graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": 21}, "raise_anomaly": true, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "live_mlag_imbalance"}, "type": "match_count", "name": "mlag imbalance per link count", "outputs": {"out": "mlag_imbalance_link_count"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}, {"inputs": {"in": "live_port_channel_imbalance"}, "type": "match_perc", "name": "port-channel imbalance per rack", "outputs": {"out": "port_channel_imbalance_per_rack"}, "properties": {"enable_streaming": false, "group_by": ["rack"], "reference_state": "true"}}, {"inputs": {"in": "mlag_port_channel_imbalance_out_of_range"}, "type": "match_perc", "name": "mlag port-channel imbalance per rack", "outputs": {"out": "mlag_port_channel_imbalance_anomaly_per_rack"}, "properties": {"enable_streaming": false, "group_by": ["rack"], "reference_state": "true"}}], "stages": [{"name": "mlag_port_channel_imbalance_out_of_range", "retention_duration": 86400}, {"name": "mlag_int_traffic", "retention_duration": 86400, "units": "bps"}, {"name": "std_dev_percentage_mlag", "retention_duration": 86400, "units": "%"}, {"name": "port_channel_imbalance_per_rack", "retention_duration": 86400}, {"name": "live_port_channel_imbalance", "retention_duration": 86400}, {"name": "mlag_int_traffic_avg", "enable_metric_logging": true, "retention_duration": 60, "units": "bps"}, {"name": "mlag_int_traffic_imbalance", "retention_duration": 86400, "units": "bps"}, {"name": "std_dev_percentage_pc", "retention_duration": 86400, "units": "%"}, {"name": "mlag_imbalance_link_count", "retention_duration": 86400, "description": "Number of MLAG links with imbalance."}, {"name": "mlag_port_channel_total", "retention_duration": 86400, "units": "bps"}, {"name": "std_dev_percentage_mlag_pc", "retention_duration": 86400, "units": "%"}, {"name": "port_channel_int_std_dev", "retention_duration": 86400, "units": "bps"}, {"name": "mlag_port_channel_imbalance_anomaly_per_rack", "retention_duration": 86400}, {"name": "live_mlag_imbalance", "retention_duration": 86400}, {"name": "mlag_port_channel_imbalance", "retention_duration": 86400, "units": "bps"}], "disabled": true}