{"label": "Fault_Tolerance  - Spine fault tolerance", "description": "Find out if failure of given number of spines in the fabric is going to be tolerated. Raise anomaly if total traffic on all spines is more than the available spine capacity, with the specified number of spine failures.", "processors": [{"inputs": {}, "type": "if_counter", "name": "Interface rx bps", "outputs": {"out": "Interface rx bps"}, "properties": {"description": "str(intf.description)", "graph_query": "node('system', name='system', deploy_mode='deploy', role='spine').out('hosted_interfaces').node('interface', name='intf', if_name=not_none()).out('link').node('link', role='spine_leaf', name='link').in_('link').node('interface').in_('hosted_interfaces').node('system', role='leaf', system_id=not_none())", "interface": "intf.if_name", "system_id": "system.system_id", "enable_streaming": false, "counter_type": "rx_bps"}}, {"inputs": {"in": "Interface rx bps"}, "type": "periodic_average", "name": "Average interface rx bps", "outputs": {"out": "Average interface rx bps"}, "properties": {"enable_streaming": false, "period": 60, "graph_query": []}}, {"inputs": {"in": "Average interface rx bps"}, "type": "sum", "name": "Total spine rx bps", "outputs": {"out": "Total spine rx bps"}, "properties": {"enable_streaming": false, "group_by": []}}, {"inputs": {"in": "Total spine rx bps"}, "type": "range_check", "name": "Check fault tolerance threshold", "outputs": {"out": "Traffic exceeds fault tolerance threshold"}, "properties": {"graph_query": ["node('system', name='system', deploy_mode='deploy', role='spine').out('hosted_interfaces').node('interface', name='intf', if_name=not_none()).out('link').node('link', role='spine_leaf', name='link').in_('link').node('interface').in_('hosted_interfaces').node('system', role='leaf', system_id=not_none())"], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "range": {"min": "(len({qr['system'].system_id for qr in query_result}) - 1) * sum([functions.speed_to_bits(qr['link'].speed, default=0) for qr in query_result if qr['system'].system_id == query_result[0]['system'].system_id])"}, "raise_anomaly": false, "enable_streaming": false, "property": "value", "enable_anomaly_logging": false}}, {"inputs": {"in": "Traffic exceeds fault tolerance threshold"}, "type": "time_in_state_check", "name": "Persistent fault intolerant traffic", "outputs": {"out": "Persistent fault intolerant traffic"}, "properties": {"time_window": 600, "graph_query": [], "anomaly_retention_size": 1073741824, "anomaly_retention_duration": 86400, "state_range": {"\"true\"": [{"min": 541}]}, "raise_anomaly": true, "enable_streaming": false, "enable_anomaly_logging": false}}, {"inputs": {"in": "Persistent fault intolerant traffic"}, "type": "match_count", "name": "Fault intolerant traffic", "outputs": {"out": "Fault intolerant traffic"}, "properties": {"enable_streaming": false, "group_by": [], "reference_state": "true"}}], "stages": [{"name": "Traffic exceeds fault tolerance threshold", "retention_duration": 86400, "description": "Raises anomaly if total spine bandwidth exceeds available capacity, considering fault tolerance"}, {"name": "Interface rx bps", "retention_duration": 86400, "description": "spine interfaces facing leaf interfaces that are part of the fabric. Value is ingress bits per second", "units": "bps"}, {"name": "Average interface rx bps", "retention_duration": 86400, "units": "bps"}, {"name": "Persistent fault intolerant traffic", "enable_metric_logging": true, "retention_duration": 86400}, {"name": "Fault intolerant traffic", "retention_duration": 86400}, {"name": "Total spine rx bps", "enable_metric_logging": true, "retention_duration": 43200, "units": "bps"}], "disabled": true}