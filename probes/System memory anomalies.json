{
  "label": "System memory anomalies",
  "processors": [
    {
      "inputs": {},
      "type": "generic_data_collector",
      "name": "Collect system memory rates",
      "outputs": {
        "out": "system memory_rate"
      },
      "properties": {
        "graph_query": "match(node('system', name='system', system_id=not_none(), deploy_mode='deploy', role=is_in(['leaf', 'spine'])))",
        "data_type": "ns",
        "service_interval": "120",
        "service_name": "resource_usage",
        "execution_count": "-1",
        "system_id": "system.system_id",
        "service_input": "\"\"",
        "key": "'system|memory_rate'",
        "enable_streaming": false
      }
    },
    {
      "inputs": {
        "in": "system memory_rate"
      },
      "type": "periodic_average",
      "name": "Periodic average of system memory rate",
      "outputs": {
        "out": "system average_memory_rate"
      },
      "properties": {
        "enable_streaming": false,
        "period": 1800,
        "graph_query": []
      }
    },
    {
      "inputs": {
        "in": "system memory_rate"
      },
      "type": "accumulate",
      "name": "System memory rate history",
      "outputs": {
        "out": "system memory_rate_history"
      },
      "properties": {
        "enable_streaming": false,
        "max_samples": 50,
        "graph_query": [],
        "total_duration": 0
      }
    },
    {
      "inputs": {
        "in": "system average_memory_rate"
      },
      "type": "range_check",
      "name": "System memory rate exceeding threshold",
      "outputs": {
        "out": "system memory_rate_out_of_range"
      },
      "properties": {
        "enable_streaming": false,
        "property": "value",
        "range": {
          "min": 1
        },
        "raise_anomaly": false,
        "graph_query": []
      }
    },
    {
      "inputs": {
        "in": "system memory_rate_out_of_range"
      },
      "type": "time_in_state_check",
      "name": "Sustained system memory leak",
      "outputs": {
        "out": "system memory_leak"
      },
      "properties": {
        "enable_streaming": false,
        "time_window": 36000,
        "state_range": {
          "\"false\"": [
            {
              "min": 35001
            }
          ]
        },
        "raise_anomaly": true,
        "graph_query": []
      }
    },
    {
      "inputs": {
        "in": "system memory_leak"
      },
      "type": "accumulate",
      "name": "Anomaly history of memory usage",
      "outputs": {
        "out": "system memory_leak_anomaly_history"
      },
      "properties": {
        "enable_streaming": false,
        "max_samples": 50,
        "graph_query": [],
        "total_duration": 0
      }
    }
  ]
}